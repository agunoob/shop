"use strict"

const baza = {
    "products":[
        {
            "id": 0,
            "gallery": [
                {
                    "id": 0,
                    "pic": "../sklep/pictures/pencils/pencils.jpg",
                    "isActive": false
                },
                {
                    "id": 1,
                    "pic": "../sklep/pictures/pencils/pencils2.jpg",
                    "isActive": false
                },
                {
                    "id": 2,
                    "pic": "../sklep/pictures/pencils/pencils3.jpg",
                    "isActive": false
                },
                {
                    "id": 3,
                    "pic": "../sklep/pictures/pencils/pencils4.jpg",
                    "isActive": false
                },
                {
                    "id": 4,
                    "pic": "../sklep/pictures/pencils/pencils5.jpg",
                    "isActive": false
                }
            ],
            "name": "6 Color Pencils",
            "price": 8.50,
            "color": "more",
            "material": "wood, pastel",
            "size": "17cmx10cm",
            "amount": 31
        },
        { 
            "id": 1,
            "gallery": [
                {
                    "id": 0,
                    "pic": "../sklep/pictures/ruler/ruler.jpg",
                    "isActive": false
                },
                {
                    "id": 1,
                    "pic": "../sklep/pictures/ruler/ruler2.jpg",
                    "isActive": false
                },
                {
                    "id": 2,
                    "pic": "../sklep/pictures/ruler/ruler3.jpeg",
                    "isActive": false
                },
                {
                    "id": 3,
                    "pic": "../sklep/pictures/ruler/ruler4.jpg",
                    "isActive": false
                },
                {
                    "id": 4,
                    "pic": "../sklep/pictures/ruler/ruler5.jpg",
                    "isActive": false
                },
                {
                    "id": 5,
                    "pic": "../sklep/pictures/ruler/ruler6.jpg",
                    "isActive": false
                },
                {
                    "id": 6,
                    "pic": "../sklep/pictures/ruler/ruler7.jpg",
                    "isActive": false
                }
            ],
            "name": "Ruler",
            "price": 4.80,
            "color": "transparent",
            "material": "plastic",
            "size": "20cmx4cm",
            "amount": 4
        },
        {
            "id": 2,
            "gallery": [
                {
                    "id": 0,
                    "pic": "../sklep/pictures/notebook/notebook.jpg",
                    "isActive": false
                },
                {
                    "id": 1,
                    "pic": "../sklep/pictures/notebook/notebook2.jpg",
                    "isActive": false
                },
                {
                    "id": 2,
                    "pic": "../sklep/pictures/notebook/notebook3.jpeg",
                    "isActive": false
                },
                {
                    "id": 3,
                    "pic": "../sklep/pictures/notebook/notebook4.jpg",
                    "isActive": false
                },
                {
                    "id": 4,
                    "pic": "../sklep/pictures/notebook/notebook5.png",
                    "isActive": false
                },
                {
                    "id": 5,
                    "pic": "../sklep/pictures/notebook/notebook6.jpg",
                    "isActive": false
                }
            ],
            "name": "Notebook",
            "price": 3.40,
            "color": "pink/bird",
            "material": "paper",
            "size": "A5 14.8cmx21cm",
            "amount": 29
        },
        {
            "id": 3,
            "gallery": [
                {
                    "id": 0,
                    "pic": "../sklep/pictures/bic/bic.jpg",
                    "isActive": false
                },
                {
                    "id": 1,
                    "pic": "../sklep/pictures/bic/bic2.jpg",
                    "isActive": false
                },
                {
                    "id": 2,
                    "pic": "../sklep/pictures/bic/bic3.jpeg",
                    "isActive": false
                },
                {
                    "id": 3,
                    "pic": "../sklep/pictures/bic/bic4.jpg",
                    "isActive": false
                },
                {
                    "id": 4,
                    "pic": "../sklep/pictures/bic/bic5.jpg",
                    "isActive": false
                }
            ],
            "name": "Bic Crystal Pen",
            "price": 4.20,
            "color": "blue",
            "material": "plastic",
            "size": "17cmx0,7cm",
            "amount": 50
        },
        {
            "id": 4,
            "gallery": [
                {
                    "id": 0,
                    "pic": "../sklep/pictures/eraser/eraser.jpg",
                    "isActive": false
                },
                {
                    "id": 1,
                    "pic": "../sklep/pictures/eraser/eraser2.jpg",
                    "isActive": false
                },
                {
                    "id": 2,
                    "pic": "../sklep/pictures/eraser/eraser3.jpg",
                    "isActive": false
                }
            ],
            "name": "Eraser",
            "price": 1.80,
            "color": "white",
            "material": "plastic",
            "size": "4cmx1cm",
            "amount": 24
        },
        {
            "id": 5,
            "gallery": [
                {
                    "id": 0,
                    "pic": "../sklep/pictures/drawingPad/pad.jpg",
                    "isActive": false
                },
                {
                    "id": 1,
                    "pic": "../sklep/pictures/drawingPad/pad2.jpeg",
                    "isActive": false
                },
                {
                    "id": 2,
                    "pic": "../sklep/pictures/drawingPad/pad3.jpg",
                    "isActive": false
                }
            ],
            "name": "Drawing Paper Pad",
            "price": 8.90,
            "color": "white",
            "material": "paper",
            "size": "A4 29,7cmx21cmx5cm",
            "amount": 74
        },
        {
            "id": 6,
            "gallery": [
                {
                    "id": 0,
                    "pic": "../sklep/pictures/redInk/ink.jpeg",
                    "isActive": false
                },
                {
                    "id": 1,
                    "pic": "../sklep/pictures/redInk/ink2.jpeg",
                    "isActive": false
                },
                {
                    "id": 2,
                    "pic": "../sklep/pictures/redInk/ink3.jpg",
                    "isActive": false
                },
                {
                    "id": 3,
                    "pic": "../sklep/pictures/redInk/ink4.jpg",
                    "isActive": false
                },
                {
                    "id": 4,
                    "pic": "../sklep/pictures/redInk/ink5.jpg",
                    "isActive": false
                }
            ],
            "name": "Red Printer Ink",
            "price": 37.90,
            "color": "red",
            "material": "dye",
            "size": "12,50cmx5,70cmx8,20cm",
            "amount": 13
        }
    ]
};

let myObj;

function dataBase(bazaJSON){
    const myJSON = JSON.stringify(bazaJSON);
    localStorage.setItem("testJSON", myJSON);
    const getIt = localStorage.getItem("testJSON");
    return JSON.parse(getIt);
};

displayOfProducts();

function displayOfProducts() {
    myObj = dataBase(baza);
    for (let i in myObj.products) {
        const createDiv = document.createElement('div');
        let newDiv = document.getElementById('products-box').appendChild(createDiv);
        newDiv.classList.add('product');
        newDiv.onclick = function showMore() {
            backgroundDlaModala(i); 
        }
        zdjecie(newDiv, i);
        nazwa(newDiv, i);
        cena(newDiv, i);
        dodajDoKoszyka(newDiv);
    }
    //wez koszyk z localstorage
    let koszyk = JSON.parse(localStorage.getItem("koszyk"));
    //jesli jest pusty lub null
    if (koszyk == null || koszyk.length == 0) {
        //do localstorage jako pusty array
        localStorage.setItem("koszyk", JSON.stringify([]));
    } else {
        //do localsotrage jako pelny array
        localStorage.setItem("koszyk", JSON.stringify(koszyk));
    }
};

function backgroundDlaModala(i) {
    const createDivModal = document.createElement('div');
    let divModal = document.body.appendChild(createDivModal);
    divModal.classList.add('modal-background');
    stworzenieModala(divModal, i);
};

function zdjecie(newDiv, i) {
    const createImg = document.createElement('img');
    let newImg = newDiv.appendChild(createImg);
    newImg.classList.add('description', 'photo');
    newImg.src = myObj.products[i].gallery[0].pic;
};

function nazwa(newDiv, i) {
    const createP = document.createElement('p');
    let newP = newDiv.appendChild(createP);
    newP.classList.add('description', 'letters');
    newP.innerHTML = myObj.products[i].name;
};

function cena(newDiv, i) {
    const createAnotherP = document.createElement('p');
    let newAnotherP = newDiv.appendChild(createAnotherP);
    newAnotherP.classList.add('description', 'letters');
    newAnotherP.innerHTML = myObj.products[i].price.toFixed(2) + 'zł';
};

function dodajDoKoszyka(newDiv) {
    const createAnotherImg = document.createElement('img');
    let newAnotherImg = newDiv.appendChild(createAnotherImg);
    newAnotherImg.classList.add('description', 'add');
    newAnotherImg.src = "../sklep/pictures/icons/plus.png";
};

function stworzenieModala(divModal, i, pD){
    const createDivShowMore = document.createElement('div');
    let divShowMore = divModal.appendChild(createDivShowMore);
    divShowMore.classList.add('more');
    funkcjonalnoscZamykaniaModala(divShowMore, divModal);
    zdjeciaWModalu(divShowMore, i);
    nazwaPrzedmiotuWModalu(divShowMore, i);
    let przyciskAdd = przyciskAddWModalu(divShowMore, i, pD);
    opisPrzediomtuWModalu(divShowMore, i, przyciskAdd, pD);
};

function funkcjonalnoscZamykaniaModala(divShowMore, divModal) {
    const createImgExit = document.createElement('img');
    let ImgExit = divShowMore.appendChild(createImgExit);
    ImgExit.classList.add('exit');
    ImgExit.src = "../sklep/pictures/icons/x-mark.png";
    ImgExit.onclick = function hideXModal() {
        divModal.style.display = 'none';
    }
    window.onclick = function hideOutsideModal (event) {
        if (event.target == divModal) {
            divModal.style.display = 'none';
        }
    }
};

function zdjeciaWModalu(divShowMore, i) {
    let glwZdjecie = glowneZdjecieWModalu(divShowMore, i);
    let divWrapper = divDlaGalerii(divShowMore);
    let divWGalerii = divGaleria(divWrapper, divShowMore);
    leftArrow(divWrapper, divWGalerii);
    rightArrow(divWrapper, divWGalerii);
    zdjeciaWGalerii(divWGalerii, i, glwZdjecie);
};

function glowneZdjecieWModalu(divShowMore, i) {
    const createModalImg = document.createElement('img');
    let modalImg = divShowMore.appendChild(createModalImg);
    modalImg.classList.add('description', 'photo-modal');
    modalImg.src = myObj.products[i].gallery[0].pic;
    return modalImg;
};

function divDlaGalerii(divShowMore) {
    const createDivDlaGalerii = document.createElement('div');
    let divWrapper = divShowMore.appendChild(createDivDlaGalerii);
    divWrapper.classList.add('galeria-wrapper');
    return divWrapper;
};

function divGaleria(divWrapper) {
    const createDivWGalerii = document.createElement('div');
    let divWGalerii = divWrapper.appendChild(createDivWGalerii);
    divWGalerii.classList.add('slide');
    return divWGalerii;
};

function leftArrow(divWrapper, divWGalerii) {
    const createArrowL = document.createElement('img');
    let arrowL = divWrapper.appendChild(createArrowL);
    arrowL.classList.add('arrows', 'arrow-l');
    arrowL.src = "../sklep/pictures/icons/left-arrow.png";
    arrowL.onclick = function goLeftGallery() {
        divWGalerii.scrollLeft -= 160;
    }
};

function rightArrow(divWrapper, divWGalerii) {
    const createArrowR = document.createElement('img');
    let arrowR = divWrapper.appendChild(createArrowR);
    arrowR.classList.add('arrows', 'arrow-r');
    arrowR.src= "../sklep/pictures/icons/right-arrow.png";
    arrowR.onclick = function goRightGallery() {
        divWGalerii.scrollLeft += 160;
    }
};

function zdjeciaWGalerii(divWGalerii, i, glwZdjecie) {
    for (let j in myObj.products[i].gallery) {
        const createImgGallery = document.createElement('img')
        let imgGal = divWGalerii.appendChild(createImgGallery);
        imgGal.classList.add('gal');
        imgGal.src = myObj.products[i].gallery[j].pic;
        imgGal.onclick = function showPicAsMain() {
            glwZdjecie.src = myObj.products[i].gallery[j].pic;                     
                let zKlasa = document.querySelectorAll('.active');
                console.log(zKlasa);
                if(zKlasa.length>0){
                    zKlasa[0].classList.remove('active');
                }
                imgGal.classList.add('active');
        }
    }
};

function nazwaPrzedmiotuWModalu(divShowMore, i) {
    const createPNext = document.createElement('p');
    let PNext = divShowMore.appendChild(createPNext);
    PNext.classList.add('description', 'name-grid');
    PNext.innerHTML = myObj.products[i].name;
};

function opisPrzediomtuWModalu(divShowMore, i, pD) {
    testFunction(i, divShowMore);
    cenaWModalu(divShowMore, i);
    kolorWModalu(divShowMore, i);
    materialWModalu(divShowMore, i);
    rozmiarWModalu(divShowMore, i);
    pD = iloscProduktow(divShowMore, i);
};

function cenaWModalu(divShowMore, i) {
    const createAnotherPNext = document.createElement('p');
    let AnotherPNext = divShowMore.appendChild(createAnotherPNext);
    AnotherPNext.classList.add('description', 'letters-more');
    AnotherPNext.innerHTML = 'price: ' + myObj.products[i].price.toFixed(2) + 'zł';
};

function kolorWModalu(divShowMore, i) {
    const createPA = document.createElement('p');
    let pA = divShowMore.appendChild(createPA);
    pA.classList.add('description', 'letters-more');
    pA.innerHTML = 'color: ' + myObj.products[i].color;
};

function materialWModalu(divShowMore, i) {
    const createPB = document.createElement('p');
    let pB = divShowMore.appendChild(createPB);
    pB.classList.add('description', 'letters-more');
    pB.innerHTML = 'material: ' + myObj.products[i].material;
};

function rozmiarWModalu(divShowMore, i) {
    const createPC = document.createElement('p');
    let pC = divShowMore.appendChild(createPC);
    pC.classList.add('description', 'letters-more');
    pC.innerHTML = 'size: ' + myObj.products[i].size;
};

function iloscProduktow(divShowMore, i) {
    let koszyk = JSON.parse(localStorage.getItem("koszyk"));
    let porownajId = koszyk.find(j => j.id === myObj.products[i].id)
    if (porownajId) {
        console.log('w koszyku jest ten produkt', koszyk);
        const createPD = document.createElement('p');
        let pD = divShowMore.appendChild(createPD);
        pD.classList.add('description', 'letters-more');
        pD.innerHTML = 'dodaj';
        console.log(pD.innerHTML);
        localStorage.setItem("koszyk", JSON.stringify(koszyk));
    } else {
    console.log('w koszyku nie ma tego produktu', koszyk);
    const createPD = document.createElement('p');
    let pD = divShowMore.appendChild(createPD);
    pD.classList.add('description', 'letters-more');
    pD.innerHTML = 'amount: ' + myObj.products[i].amount;
    console.log(pD.innerHTML);
    localStorage.setItem("koszyk", JSON.stringify(koszyk));
    return pD;
    }
};

function testFunction(i, addModal) {
    if (myObj.products[i].amount < 1) {
        addModal.classList.add('unavailable');
    }
};

function przyciskAddWModalu(divShowMore, i, pD) {
    const createAddModal = document.createElement('button');
    let addModal = divShowMore.appendChild(createAddModal);
    addModal.classList.add('description', 'add-modal');
    addModal.innerHTML = 'add to cart';
    addModal.onclick = (()=> {
        

        let odejmowanie = myObj.products[i].amount - 1;
        // console.log(odejmowanie);
        myObj.products[i].amount = odejmowanie;
        console.log(odejmowanie);
        // pD.innerHTML = odejmowanie;
        console.log('pd:', pD);



        const kupujeTenProdukt = 
        {
            id: myObj.products[i].id,
            name: myObj.products[i].name, 
            picture: myObj.products[i].gallery[0].pic, 
            price: myObj.products[i].price,

        }
        let koszyk = JSON.parse(localStorage.getItem("koszyk"));
        let produktWKoszyku = koszyk.find( p => p.id === kupujeTenProdukt.id)
        if (!produktWKoszyku) {
            const nowyProdukt= {
                id: kupujeTenProdukt.id,
                name:kupujeTenProdukt.name,
                picture:kupujeTenProdukt.picture,
                price:kupujeTenProdukt.price,
                count: 1
            }
            koszyk.push(nowyProdukt);
        } else {
            produktWKoszyku.count ++;
        }
        // const createIleElementow = document.createElement('p');
        // let ileElementow = document.getElementById('cart').appendChild(createIleElementow);
        // ileElementow.classList.add('ile-elementow');
        // let suma = 0;
        // suma += +koszyk[i].count;
        // ileElementow.innerHTML = suma;
       
        localStorage.setItem("koszyk", JSON.stringify(koszyk));
    })
    return addModal;
};

window.ondragstart = function() { 
    return false; 
};
